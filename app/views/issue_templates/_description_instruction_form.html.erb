<% if template
     template_class = "template"
     template_target_name = "data-target=split-description.instruction_template"
     template_style = "style=display:none;"
     details_link_label = 'Masquer les détails'
   else
     template_class = "collapsed"
     details_link_label = 'Afficher les détails'
   end %>
<div class="split_description instruction <%= template_class %>"
     data-controller="description-item-form" <%= template_target_name %> <%= template_style %>>

  <span style="float: right;">
    <a class="icon icon-del link-cursor" rel="nofollow" data-action="description-item-form#delete">Supprimer</a>
    <%= form.hidden_field :_destroy, :value => 0, "data-target" => "description-item-form.destroy_hidden" %>
  </span>

  <%= reorder_handle(form.object, :url => "#") %>
  <p>
    <%= label_tag 'Consigne' %>
    <%= form.hidden_field :position %>

    <%= form.select :instruction_type, IssueTemplateDescriptionInstruction.instruction_types_options, :no_label => true %>
    <%= link_to details_link_label, '#',
                class: 'expand_collapse',
                data: {action: "description-item-form#expand_collapse"} %>
  </p>

  <div class="collapsible">
    <p class="with-textarea">
      <%= form.text_area :text,
                         :cols => 60,
                         :rows => (form.object&.text.blank? ? 10 : [[10, form.object.text.length / 50].max, 100].min),
                         :accesskey => accesskey(:edit),
                         :class => "wiki-edit",
                         :no_label => true,
                         :placeholder => "Obligatoire",
                         :data => {
                             "help-link" => "#{Redmine::Utils.relative_url_root}/help/#{current_language.to_s.downcase}/wiki_syntax_textile.html",
                             "preview-link" => preview_text_path
                         }
      %>
      <%= wikitoolbar_for "issue_template_descriptions_attributes_#{form.index}_text" %>
      <%= form.hidden_field :type, :value => "IssueTemplateDescriptionInstruction" %>
    </p>
  </div>
</div>
